---
title: Blog
layout: blogpost
---

<script>
  console.log("Loading blog feed from http://Triangle717.WordPress.com");

  // Store all the blog post objects
  var allBlogPosts = [];

  function BlogPost(postAuthor, postDate, postID, postTitle, postURL, postContent) {
    this.postAuthor       = postAuthor.name;
    this.postAuthorAvatar = postAuthor.avatar_URL.replace(/s=96/, "s=64");
    this.postContainer    = '<div id="{0}"></div>'.format(postID);
    this.postContent      = postContent;
    // FUTURE Convert to datestamp to keep time posted
    this.postDate         = postDate.replace(/(T(.*))$/g, "");
    this.postID           = postID;
    this.postIDDOM        = "#" + postID;
    this.postTitle        = postTitle;
    this.postURL          = postURL;
  }

  $(function() {
    "use strict";
    /* Create a blog post object
     * Based on example from http://jsfiddle.net/hLWdH/334/
     */
    $.getJSON("http://public-api.wordpress.com/rest/v1/sites/triangle717.wordpress.com/posts/?number=1&callback=?", function(data) {
      console.log("{0} blog posts retrieved".format(data.posts.length));

      data.posts.forEach(function(postInfo) {
        // Create a unique post ID
        var postID  = "post-{0}".format(postInfo.guid.substring(postInfo.guid.indexOf("?p=") + 3, postInfo.guid.length));

        // Create the post object and store it
        var myPost = new BlogPost(postInfo.author, postInfo.date, postID, postInfo.title, postInfo.guid, postInfo.content);
        allBlogPosts.push(myPost);
      });

      // Now that the posts are stored, go through and display them
      showPosts();
      });
    });

    function showPosts() {
      "use strict";
      /* Display each blog post */
      $.each(allBlogPosts, function(key, value) {

      // Add the post container to the page
      $("body").append(value.postContainer);

        /* Display post details in the following order:
         *
         * Post title
         * Author avatar
         * Publish date
         * Author name
         * Permalink (to WordPress)
         */

        $(value.postIDDOM).append('<h1 class="text-center post-title"></h1>');
        $(value.postIDDOM).append('<img class="post-author-avatar" />');
        $(value.postIDDOM).append('<p class="post-info">Published on <span class="post-date"></span> by <span class="post-author"></span> (<a class="post-url" target="_blank">Permalink</a>)</p>');

        $(value.postIDDOM + " .post-title").html(value.postTitle);
        $(value.postIDDOM + " .post-author-avatar").attr("src", value.postAuthorAvatar);
        $(value.postIDDOM + " .post-date").html(value.postDate);
        $(value.postIDDOM + " .post-author").html(value.postAuthor);
        $(value.postIDDOM + " .post-url").attr("href", value.postURL);

        // Finally, add the post content
        $(value.postIDDOM).append(value.postContent);

        // Convert all WordPress emoticons to Emoji
        //$(value.postIDDOM).wpToEmoji();

        // Run various cleanup functions
        cleanupPost(value.postIDDOM);
    });
  }


  function cleanupPost(postContainer) {
    "use strict";
    /* Remove WordPress classes, IDs, and other unnecessary clutter */

    $(function() {

      // Remove WordPress emote classes
      $(postContainer).find("span").each(function() {
        var $this = $(this);
        $this.removeClass("emoji");
        $this.removeClass("wp-smiley");
  //      $this.stripClass("emoji-");
        $this.removeAttr("title");
      });

      // Remove WordPress image styling
      $("img").removeAttr("style");

      // Center the images that have captions applied
      $(".wp-caption").addClass("text-center");

      // Remove any WordPress image-related classes
      $(postContainer).find("img").each(function() {
        var $this = $(this);
        $this.removeAttr("class");

        // Center non-captioned images
        $this.parent("p").addClass("text-center");

        // Add my own image styling
        $this.addClass("img-shadow");

        // If this is a mobile browser, third the image sizes
        if ($.browser.mobile) {
          $this.width($this.width() / 3);
          $this.height($this.height() / 3);
        }
      });

      $(".emoji-bigsmile").html(":smiley:");

      // Remove any WordPress alignment classes and style attributes
      $(postContainer).find("div").each(function() {
        var $this = $(this);
        $this.removeClass("alignnone");
        $this.removeClass("alignleft");
        $this.removeClass("aligncenter");
        $this.removeClass("alignright");
        $this.removeClass("wp-caption");
        $this.stripClass("attachment_");
        $this.removeAttr("style");
      });
   });
  }
</script>
