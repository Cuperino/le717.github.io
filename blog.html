---
title: Blog
layout: blogpost
---

{% include loading.html %}
<div class="blog-posts"></div>

<script>
  console.log("Loading blog feed from http://Triangle717.WordPress.com");

  // Store all the blog post objects
  var allBlogPosts = [];

  function BlogPost(postAuthor, postDate, postID, postTitle, postURL, postContent) {
    this.postAuthor       = postAuthor.name;
    this.postAuthorAvatar = postAuthor.avatar_URL.replace(/s=96/, "s=40");
    this.postContainer    = '<div id="{0}"></div>'.format(postID);
    this.postContent      = postContent;
    this.postDate         = postDate;
    this.postID           = postID;
    this.postIDDOM        = "#" + postID;
    this.postTitle        = postTitle;
    this.postURL          = postURL;
  }

  (function() {
    "use strict";
    /* Create a blog post object
     * Based on example from http://jsfiddle.net/hLWdH/334/
     */
    $.getJSON("//public-api.wordpress.com/rest/v1/sites/triangle717.wordpress.com/posts/?number=7&callback=?", function(data) {
      console.log("{0} blog posts retrieved".format(data.posts.length));

      data.posts.forEach(function(postInfo) {
        // Create a unique post ID
        var postID  = "post-{0}".format(postInfo.guid.substring(postInfo.guid.indexOf("?p=") + 3, postInfo.guid.length));

        // Convert publishing date to a nicer format
        var postDate = new Date(postInfo.date).toLocaleString().split(" ");
        if (postDate.length > 3) {
          postDate[3] = postDate[3] + " at";
          postDate[4] = postDate[4].substring(0, postDate[4].length - 3);

          // Webkit converts the string differently
        } else {
          postDate[0] = postDate[0] + " at";
          postDate[1] = postDate[1].substring(0, postDate[1].length - 3);
        }
        postDate = postDate.join(" ");

        // Create the post object and store it
        var myPost = new BlogPost(postInfo.author, postDate, postID, postInfo.title, postInfo.guid, postInfo.content);
        allBlogPosts.push(myPost);
      });

      // Now that the posts are stored, go through and display them and stop the loading animation
      showPosts();
      $(".loading-ani").remove();
      $(".blog-posts").css("display", "");
      shrinkImages();
      });
    })();

    function showPosts() {
      "use strict";
      /* Display each blog post */
      $.each(allBlogPosts, function(key, value) {

      // Add the post container to the page
      $(".blog-posts").append(value.postContainer);

      // Hide post content until it is ready
      $(".blog-posts").css("display", "none");

      /* Display post details in the following order:
       *
       * Post title
       * Author avatar
       * Publish date
       * Author name
       * Permalink (back to WordPress)
       * Post content
       */

      $(value.postIDDOM).append('<h1 class="text-center post-title"></h1>');
      $(value.postIDDOM).append('<p class="post-info"><img class="post-author-avatar no-mobile-resize" alt="Author avatar" />&nbsp;&nbsp;Published on <span class="post-date"></span> by <span class="post-author"></span> (<a class="post-url" target="_blank">Permalink</a>)</p>');
      $(value.postIDDOM).append('<div class="post-content" style="display: none;"></div>');

      $(value.postIDDOM + " .post-title").html(value.postTitle);
      $(value.postIDDOM + " .post-author-avatar").attr("src", value.postAuthorAvatar);
      $(value.postIDDOM + " .post-date").html(value.postDate);
      $(value.postIDDOM + " .post-author").html(value.postAuthor);
      $(value.postIDDOM + " .post-url").attr("href", value.postURL);

      // Add the post content
      $(value.postIDDOM + " .post-content").append(value.postContent);

      // Run various cleanup functions
      cleanupPost(value.postIDDOM);
    });
  }


  function cleanupPost(postContainer) {
    "use strict";
    /* Remove WordPress classes, IDs, and other unnecessary clutter */

    $(function() {

      //$(".emoji-bigsmile").html(":smiley:");

      // Remove WordPress image styling
      $("img").removeAttr("style");

      // Center the images that have captions applied
      $(".wp-caption").addClass("text-center");

      // Remove the nested paragraph in the blockquote
      $(postContainer + " blockquote").html($(postContainer + " blockquote p").html());


      // Remove any WordPress image-related classes
      $(postContainer + " .post-content").find("img").each(function() {
        var $this = $(this);
        $this.removeAttr("class");

        // Center non-captioned images
        $this.parent("p").addClass("text-center");

        // Add my own image styling
        $this.addClass("img-shadow");

        /*if ($.browser.desktop) {
            console.log($this.width());
            console.log($(window).width() / 4);
            console.log($this.width() >= $(window).width() / 4);

            if ($this.width() >= $(window).width() / 4) {
              $this.width($this.width() / 4);
            }
        }*/
      });


      // Remove WordPress emote classes
      $(postContainer).find("span").each(function() {
        var $this = $(this);
        $this.removeAttr("class");
        $this.removeAttr("title");
      });


      // Remove any WordPress alignment classes and style attributes
      $(postContainer).find("div").each(function() {
        var $this = $(this);
        $this.removeClass("alignnone");
        $this.removeClass("alignleft");
        $this.removeClass("aligncenter");
        $this.removeClass("alignright");
        $this.removeClass("wp-caption");
        $this.removeAttr("id");
        $this.removeAttr("style");
      });


      $(postContainer).find("p").each(function() {
        var $this = $(this);

        // Apply alignment for image caption text
        if ($this.hasClass("wp-caption-text")) {
          $this.removeClass("wp-caption-text");
          $this.css("text-align", "inherit");
        }
      });
   });
  }
</script>
