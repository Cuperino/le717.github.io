---
title: Blog
layout: blogpost
---

<script>
  console.log("Loading blog feed from http://Triangle717.WordPress.com");

  $.getJSON("//public-api.wordpress.com/rest/v1/sites/triangle717.wordpress.com/posts/?number=1&callback=?", function(data) {
    "use strict";
    /* Based on example from http://jsfiddle.net/hLWdH/334/ */

    var postContent, postContainer;

//    console.log("Number of blog posts downloaded: " + data.posts.length);

    //FIXME MAJOR refactoring
      data.posts.forEach(function(postInfo) {
        var postAuthor       = postInfo.author.name,
            postAuthorAvatar = postInfo.author.avatar_URL.replace(/s=96/, "s=64"),
            // FUTURE: Convert to datestamp to keep time posted
            postDate         = postInfo.date.replace(/(T(.*))$/g, ""),
            postID           = postInfo.slug,
            postTitle        = postInfo.title,
            postURL          = postInfo.URL;
        postContent          = postInfo.content;
        postContainer        = "#" + postID;

        //console.log("Raw WP code: " + postContent);

        //postContent = postContent.replace(/style=".+"/g, "");
        //postContent = postContent.replace(/class='.+'/g, "");

        //console.log("WP code removed:\n" + postContent);

        // Display post details
        $(".post-author-avatar").attr("src", postAuthorAvatar);
        $(".post-title").html(postTitle);
        $(".post-date").html(postDate);
        $(".post-author").html(postAuthor);
        $(".post-url").attr("href", postURL);

        // Display post content
        $("body").append('<div id="' + postID + '"></div>');
        $(postContainer).html(postContent);
      });

    // Remove WordPress emote classes
    /*$(postContainer).find("span").each(function() {
      var $this = $(this);
      $this.removeClass("emoji");
      $this.stripClass("wp-");
      $this.stripClass("emoji-");
      $this.removeAttr("title");

    });*/

    // Convert all WordPress emoticons to Emoji
    $(postContainer).wpToEmoji();

    // Remove any WordPress alignment classes
    $(postContainer).find("div").each(function() {
      var $this = $(this);
      $this.removeClass("alignnone");
      $this.removeClass("alignleft");
      $this.removeClass("aligncenter");
      $this.removeClass("alignright");
      $this.removeAttr("style");

      // Center any images
      // FIXME: Wrong method!
      if ($this.hasClass("wp-caption")) {
        $this.addClass("text-center");
      }
    });

    // Remove image styling
    $("img").removeAttr("style");

    // Remove any WordPress image-related classes
    $(postContent).find("img").each(function() {
      var $this = $(this);
      //$(this).removeClass();
      //$this.stripClass("size-");
      $this.removeClass("size-large");
      //$this.addClass("img-shadow");

      // If this is a mobile browser, quarter the image sizes
      if ($.browser.mobile) {
        $this.width($this.width() / 4);
        $this.height($this.height() / 4);
      }
    });
  }, "json");
</script>
