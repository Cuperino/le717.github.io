---
layout: script
title: Blog
redirect_from: /blog.html
---

{% include loading.html %}
<div class="blog-posts"></div><br>
<p class="text-center" id="end-of-posts">
  Well, would you look at that? That's all the posts that were loaded!<br>If you would like to read more, you can visit the
  <a target="_blank" href="{{ site.wpurl }}">actual blog</a> and read to your heart's content. :smiley:
</p>

<script>
  //console.log("Loading blog feed from http://Triangle717.WordPress.com");

  // Store all the blog post objects
  var allBlogPosts = [],
      // Month conversion table
      months = {
        "01": "January",
        "02": "February",
        "03": "March",
        "04": "April",
        "05": "May",
        "06": "June",
        "07": "July",
        "08": "August",
        "09": "September",
        "10": "October",
        "11": "November",
        "12": "December"
      };

  function BlogPost(postAuthor, postDate, postID, postTitle, postURL, postContent) {
    this.postAuthor       = postAuthor.name;
    this.postAuthorAvatar = postAuthor.avatar_URL.replace(/s=96/, "s=40");
    this.postContainer    = '<div id="' + postID + '"></div>';
    this.postContent      = postContent;
    this.postDate         = postDate;
    this.postID           = postID;
    this.postIDDOM        = "#" + postID;
    this.postTitle        = postTitle;
    this.postURL          = postURL;
  }

  (function() {
    "use strict";
    /* Create a blog post object
     * Based on example from http://jsfiddle.net/hLWdH/334/
     */

    // Download a different number of posts on different platforms.
    // Downloading seven posts on mobile might be enough to crash the browser on mobile.
    var postsToDownload;
    if ($.browser.desktop) {
      postsToDownload = 7;
    } else {
      postsToDownload = 4;
    }
    
    $.ajax({
    dataType: "json",
    url: "//public-api.wordpress.com/rest/v1/sites/triangle717.wordpress.com/posts/?number=" + postsToDownload + "&callback=?",
    success: function(data) {
      //console.log("{0} blog posts retrieved".format(postsToDownload));

      data.posts.forEach(function(postInfo) {
        // Create a unique post ID
        var postID  = "post-{0}".format(postInfo.guid.substring(postInfo.guid.indexOf("?p=") + 3, postInfo.guid.length));

        // Convert publishing date to a nicer format
        var postDateParts = postInfo.date.split("T")[0].split("-");
        var dateFormat    = "{0} {1} {2},".format(postDateParts[2], postDateParts[1], postDateParts[0]).split(" ");
        dateFormat[1]     = "{0},".format(dateFormat[1].replace(dateFormat[1], months[dateFormat[1]]));
        var postDate      = dateFormat.join(" ");

        // Create the post object and store it
        var myPost = new BlogPost(postInfo.author, postDate, postID, postInfo.title, postInfo.short_URL, postInfo.content);
        allBlogPosts.push(myPost);
      });

      // Now that the posts are stored, go through and display them and stop the loading animation
      $(".ani-loading").css({"top": "15%", "left": "30%"});
      $(".ani-loading").remove();
      showPosts();
      $(".blog-posts").css("display", "");
      $("#end-of-posts").css("display", "block");
    }
      });
    })();

    function showPosts() {
      "use strict";
      /* Display each blog post */
      $.each(allBlogPosts, function(key, value) {

//      value.cleanUp();

      // Add the post container to the page
      $(".blog-posts").append(value.postContainer);

      // Hide post content until it is ready
      $(".blog-posts").css("display", "none");

      /* Display post details in the following order:
       *
       * Post title
       * Author avatar
       * Publish date
       * Author name
       * Permalink (back to WordPress)
       * Post content
       */

      $(value.postIDDOM).append('<h1 class="text-center post-title"></h1>');
      $(value.postIDDOM).append('<p class="post-info"><img class="post-author-avatar no-mobile-resize" alt="Author avatar" />&nbsp;Published <span class="post-date"></span> by <span class="post-author"></span> (<a class="post-url" target="_blank">Permalink</a>)</p>');
      $(value.postIDDOM).append('<div class="post-content" style="display: none;"></div>');

      $(value.postIDDOM + " .post-title").html(value.postTitle);
      $(value.postIDDOM + " .post-author-avatar").attr("src", value.postAuthorAvatar);
      $(value.postIDDOM + " .post-date").html(value.postDate);
      $(value.postIDDOM + " .post-author").html(value.postAuthor);
      $(value.postIDDOM + " .post-url").attr("href", value.postURL);

      // Add the post content
      $(value.postIDDOM + " .post-content").append(value.postContent);

      // Run various cleanup functions
      cleanupPost(value.postIDDOM);
    });
  }

  BlogPost.prototype.cleanUp = function() {
   "use strict";
   /* Remove WordPress classes, IDs, and other unnecessary clutter */

   console.log(this.postIDDOM);

    /*$(function() {
      // Remove WordPress image styling
      $("img").removeAttr("style");

      // Center the images that have captions applied
      $(".wp-caption").addClass("text-center");
    });*/
  };


  function cleanupPost(postContainer) {
    "use strict";
    /* Remove WordPress classes, IDs, and other unnecessary clutter */
    // TODO Move this to the BlogPost prototype

    $(function() {
      // Remove WordPress image styling
      $("img").removeAttr("style");

      // Center the images that have captions applied
      $(".wp-caption").addClass("text-center");


      // Remove any WordPress image-related classes
      $(postContainer + " .post-content").find("img").each(function() {
        var $this = $(this);
        $this.removeAttr("class");

        // Center non-captioned images
        $this.parent("p").addClass("text-center");

        // Add my own image styling
        $this.addClass("img-shadow");
        $this.addClass("img-responsive");

        /*if ($.browser.desktop) {
            console.log($this.width());
            console.log($(window).width() / 4);
            console.log($this.width() >= $(window).width() / 4);

            if ($this.width() >= $(window).width() / 4) {
              $this.width($this.width() / 4);
            }
        }*/
      });


      // Remove WordPress emote classes
      $(postContainer).find("span").each(function() {
        var $this = $(this);
        $this.removeAttr("class");
        $this.removeAttr("title");
      });

      // Remove any WordPress alignment classes and style attributes
      $(postContainer).find("div").each(function() {
        var $this = $(this);
        $this.removeClass("alignnone");
        $this.removeClass("alignleft");
        $this.removeClass("aligncenter");
        $this.removeClass("alignright");
        $this.removeClass("wp-caption");
        $this.removeAttr("id");
        $this.removeAttr("style");
      });


      $(postContainer).find("p").each(function() {
        var $this = $(this);

        // Apply alignment for image caption text
        if ($this.hasClass("wp-caption-text")) {
          $this.removeClass("wp-caption-text");
          $this.css("text-align", "inherit");
        }
      });
   });
  }
</script>
